---
ntp::servers:
  - 0.uk.pool.ntp.org
  - 1.uk.pool.ntp.org
  - 2.uk.pool.ntp.org
  - 3.uk.pool.ntp.org

hosts:
  'env-box-01':
     ip:  '10.0.0.10'
  'env-box-02':
     ip:  '10.0.0.11'

boxes:
  'env-box-01':
     box:  'centos7-micro'
     os:   'linux'
     size: 'micro'
     cpus: 1
     mem:  512
  'env-box-02':
     box:  'centos7-normal'
     os:   'linux'
     size: 'normal'
     cpus: 2
     mem:  4096

users:
  user_a:
    ensure:     present
    managehome: true
    home:       /home/user_a
    shell:      /bin/bash
    uid:        10000
    gid:        10000
    groups:
                wheel
  user_b:
    ensure:     present
    managehome: true
    home:       /home/user_b
    shell:      /bin/bash
    uid:        10001
    gid:        10002
    groups:
                wheel

ssh_keys:
  user_a:
    user:   'user_a'
    type:   'ssh-rsa'
    key:    ''
  user_b:
    user:   'user_b'
    type:   'ssh-rsa'
    key:    ''

groups:
  user_a:
    ensure: present
    gid:    10000
  user_b:
    ensure: present
    gid:    10001

jail_conf: 
  - '[DEFAULT]'
  - 'ignoreip = 127.0.0.1/8'
  - 'bantime = 600'
  - 'findtime = 600'
  - 'maxretry = 3'
  - 'backend = auto'
  - 'usedns = warn'
  - 'destemail = root@localhost'
  - 'sendername = Fail2Ban'
  - 'banaction = iptables-multiport'
  - 'mta = sendmail'
  - 'protocol = tcp'
  - 'chain = INPUT'
  - 'action_ = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]'
  - 'action_mw = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]'
  - '          %(mta)s-whois[name=%(__name__)s, dest="%(destemail)s", protocol="%(protocol)s", chain="%(chain)s", sendername="%(sendername)s"]'
  - 'action_mwl = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]'
  - '           %(mta)s-whois-lines[name=%(__name__)s, dest="%(destemail)s", logpath=%(logpath)s, chain="%(chain)s", sendername="%(sendername)s"]'
  - 'action = %(action_)s'
  - '[sshd]'
  - 'enabled = true'
  - 'port    = ssh'
  - 'logpath = %(sshd_log)s'
  - 'backend = %(sshd_backend)s'
  - '[sshd-ddos]'
  - '# This jail corresponds to the standard configuration in Fail2ban.'
  - '# The mail-whois action send a notification e-mail with a whois request'
  - '# in the body.'
  - 'enabled = true'
  - 'port    = ssh'
  - 'logpath = %(sshd_log)s'
  - 'backend = %(sshd_backend)s'
  - '[dropbear]'
  - 'enabled = true'
  - 'port     = ssh'
  - 'logpath  = %(dropbear_log)s'
  - 'backend  = %(dropbear_backend)s'

sysctl_data:
  - 'kernel.dmesg_restrict                  1'
  - 'kernel.kptr_restrict                   2'
  - 'kernel.sysrq                           0'
  - 'net.ipv4.conf.all.forwarding           0'
  - 'net.ipv4.conf.all.log_martians         1'
  - 'net.ipv4.conf.all.forwarding           0'
  - 'net.ipv4.conf.all.send_redirects       0'
  - 'net.ipv4.conf.default.accept_redirects 0'
  - 'net.ipv4.conf.default.log_martians     1'
  - 'net.ipv4.tcp_timestamps                0'
  - 'net.ipv6.conf.all.accept_redirects     0'
  - 'net.ipv6.conf.default.accept_redirects 0'
  - 'net.ipv4.conf.all.accept_redirects     0'

env_issue:
  - 'ALERT! You are entering into a secured area!'
  - 'Your IP, Login Time, Username has been noted and has been sent to the server administrator!'
  - 'This service is restricted to authorized users only. All activities on this system are logged.'
  - 'Unauthorized access will be fully investigated and reported to the appropriate law enforcement agencies.'
  - ''

auditd_rules:
  - '###################'
  - '# Remove any existing rules'
  - '###################'
  - ''
  - '-D'
  - ''
  - '###################'
  - '# Buffer Size'
  - '###################'
  - '# Might need to be increased, depending on the load of your system.'
  - '-b 8192'
  - ''
  - '###################'
  - '# Failure Mode'
  - '###################'
  - '# 0=Silent'
  - '# 1=printk, print failure message'
  - '# 2=panic, halt system'
  - '-f 1'
  - ''
  - '###################'
  - '# Audit the audit logs.'
  - '###################'
  - '-w /var/log/audit/ -k auditlog'
  - ''
  - '###################'
  - '## Auditd configuration'
  - '###################'
  - '## Modifications to audit configuration that occur while the audit (check your paths)'
  - '-w /etc/audit/ -p wa -k auditconfig'
  - '-w /etc/libaudit.conf -p wa -k auditconfig'
  - '-w /etc/audisp/ -p wa -k audispconfig'
  - ''
  - '###################'
  - '# Monitor for use of audit management tools'
  - '###################'
  - '# Check your paths'
  - '-w /usr/sbin/auditctl -p x -k audittools'
  - '-w /usr/sbin/auditd -p x -k audittools'
  - ''
  - '###################'
  - '# Special files'
  - '###################'
  - '-a exit,always -F arch=b32 -S mknod -S mknodat -k specialfiles'
  - '-a exit,always -F arch=b64 -S mknod -S mknodat -k specialfiles'
  - ''
  - '###################'
  - '# Mount operations'
  - '###################'
  - '-a exit,always -F arch=b32 -S mount -S umount -S umount2 -k mount'
  - '-a exit,always -F arch=b64 -S mount -S umount2 -k mount'
  - ''
  - '###################'
  - '# Changes to the time'
  - '###################'
  - '-a exit,always -F arch=b32 -S adjtimex -S settimeofday -S stime -S clock_settime -k time'
  - '-a exit,always -F arch=b64 -S adjtimex -S settimeofday -S clock_settime -k time'
  - '-w /etc/localtime -p wa -k localtime'
  - ''
  - '###################'
  - '# Use of stunnel'
  - '###################'
  - '-w /usr/sbin/stunnel -p x -k stunnel'
  - ''
  - '###################'
  - '# Schedule jobs'
  - '###################'
  - '-w /etc/cron.allow -p wa -k cron'
  - '-w /etc/cron.deny -p wa -k cron'
  - '-w /etc/cron.d/ -p wa -k cron'
  - '-w /etc/cron.daily/ -p wa -k cron'
  - '-w /etc/cron.hourly/ -p wa -k cron'
  - '-w /etc/cron.monthly/ -p wa -k cron'
  - '-w /etc/cron.weekly/ -p wa -k cron'
  - '-w /etc/crontab -p wa -k cron'
  - '-w /var/spool/cron/crontabs/ -k cron'
  - ''
  - '## user, group, password databases'
  - '-w /etc/group -p wa -k etcgroup'
  - '-w /etc/passwd -p wa -k etcpasswd'
  - '-w /etc/gshadow -k etcgroup'
  - '-w /etc/shadow -k etcpasswd'
  - '-w /etc/security/opasswd -k opasswd'
  - ''
  - '###################'
  - '# Monitor usage of passwd command'
  - '###################'
  - '-w /usr/bin/passwd -p x -k passwd_modification'
  - ''
  - '###################'
  - '# Monitor user/group tools'
  - '###################'
  - '-w /usr/sbin/groupadd -p x -k group_modification'
  - '-w /usr/sbin/groupmod -p x -k group_modification'
  - '-w /usr/sbin/addgroup -p x -k group_modification'
  - '-w /usr/sbin/useradd -p x -k user_modification'
  - '-w /usr/sbin/usermod -p x -k user_modification'
  - '-w /usr/sbin/adduser -p x -k user_modification'
  - ''
  - '###################'
  - '# Login configuration and stored info'
  - '###################'
  - '-w /etc/login.defs -p wa -k login'
  - '-w /etc/securetty -p wa -k login'
  - '-w /var/log/faillog -p wa -k login'
  - '-w /var/log/lastlog -p wa -k login'
  - '-w /var/log/tallylog -p wa -k login'
  - ''
  - '###################'
  - '# Network configuration'
  - '###################'
  - '-w /etc/hosts -p wa -k hosts'
  - '-w /etc/network/ -p wa -k network'
  - ''
  - '###################'
  - '## system startup scripts'
  - '###################'
  - '-w /etc/inittab -p wa -k init'
  - '-w /etc/init.d/ -p wa -k init'
  - '-w /etc/init/ -p wa -k init'
  - ''
  - '###################'
  - '# Library search paths'
  - '###################'
  - '-w /etc/ld.so.conf -p wa -k libpath'
  - ''
  - '###################'
  - '# Kernel parameters and modules'
  - '###################'
  - '-w /etc/sysctl.conf -p wa -k sysctl'
  - '-w /etc/modprobe.conf -p wa -k modprobe'
  - '###################'
  - ''
  - '###################'
  - '# PAM configuration'
  - '###################'
  - '-w /etc/pam.d/ -p wa -k pam'
  - '-w /etc/security/limits.conf -p wa  -k pam'
  - '-w /etc/security/pam_env.conf -p wa -k pam'
  - '-w /etc/security/namespace.conf -p wa -k pam'
  - '-w /etc/security/namespace.init -p wa -k pam'
  - ''
  - '###################'
  - '# Postfix configuration'
  - '###################'
  - '-w /etc/aliases -p wa -k mail'
  - '-w /etc/postfix/ -p wa -k mail'
  - '###################'
  - ''
  - '###################'
  - '# SSH configuration'
  - '###################'
  - '-w /etc/ssh/sshd_config -k sshd'
  - ''
  - '###################'
  - '# Hostname'
  - '###################'
  - '-a exit,always -F arch=b32 -S sethostname -k hostname'
  - '-a exit,always -F arch=b64 -S sethostname -k hostname'
  - ''
  - '###################'
  - '# Changes to issue'
  - '###################'
  - '-w /etc/issue -p wa -k etcissue'
  - '-w /etc/issue.net -p wa -k etcissue'
  - ''
  - '###################'
  - '# Log all commands executed by root'
  - '###################'
  - '-a exit,always -F arch=b64 -F euid=0 -S execve -k rootcmd'
  - '-a exit,always -F arch=b32 -F euid=0 -S execve -k rootcmd'
  - ''
  - '###################'
  - '## Capture all failures to access on critical elements'
  - '###################'
  - '-a exit,always -F arch=b64 -S open -F dir=/etc -F success=0 -k unauthedfileacess'
  - '-a exit,always -F arch=b64 -S open -F dir=/bin -F success=0 -k unauthedfileacess'
  - '-a exit,always -F arch=b64 -S open -F dir=/home -F success=0 -k unauthedfileacess'
  - '-a exit,always -F arch=b64 -S open -F dir=/sbin -F success=0 -k unauthedfileacess'
  - '-a exit,always -F arch=b64 -S open -F dir=/srv -F success=0 -k unauthedfileacess'
  - '-a exit,always -F arch=b64 -S open -F dir=/usr/bin -F success=0 -k unauthedfileacess'
  - '-a exit,always -F arch=b64 -S open -F dir=/usr/local/bin -F success=0 -k unauthedfileacess'
  - '-a exit,always -F arch=b64 -S open -F dir=/usr/sbin -F success=0 -k unauthedfileacess'
  - '-a exit,always -F arch=b64 -S open -F dir=/var -F success=0 -k unauthedfileacess'
  - ''
  - '###################'
  - '## su/sudo'
  - '###################'
  - '-w /usr/bin/su -p x -k priv_esc'
  - '-w /usr/bin/sudo -p x -k priv_esc'
  - '-w /etc/sudoers -p rw -k priv_esc'
  - ''
  - '###################'
  - '# Poweroff/reboot tools'
  - '###################'
  - '-w /usr/sbin/halt -p x -k power'
  - '-w /usr/sbin/poweroff -p x -k power'
  - '-w /usr/sbin/reboot -p x -k power'
  - '-w /usr/sbin/shutdown -p x -k power'
  - ''
  - '###################'
  - '# Make the configuration immutable'
  - '###################'
  - '-e 2'
  - ''
  - '# EOF'

